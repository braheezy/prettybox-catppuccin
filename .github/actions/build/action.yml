name: Packer Build

runs:
  using: "composite"
  steps:
    - name: Install build deps
      run: sudo sh ./configure
      shell: bash

    # As recommended by the Packer Github Action, run a bunch of pre-checks
    - name: Validate template syntax
      uses: hashicorp/packer-github-actions@master
      with:
        command: validate
        arguments: --syntax-only
        target: template.pkr.hcl

    - name: Build artifacts
      run: make vbox
      shell: bash
      env:
        PACKER_LOG: 1
        CI: 1
